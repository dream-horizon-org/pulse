receivers:
  kafka:
    brokers:
      - kafka:9092
    protocol_version: "3.5.0"
    client_id: otel-clickhouse-writer
    group_id: otel-clickhouse-writer

    # Traces from pulse.traces
    traces:
      topic: pulse.traces
      encoding: otlp_proto    # must match exporter encoding from otel-collector-1

    # Metrics from pulse.metrics
    metrics:
      topic: pulse.metrics
      encoding: otlp_proto

    # Logs (only the "other" logs) from pulse.logs.other
    logs:
      topic: pulse.logs.other
      encoding: otlp_proto

processors:
  batch:
    send_batch_size: 1000
    timeout: 10s
    send_batch_max_size: 1500

exporters:
  clickhouse:
    # driven by env vars from docker-compose
    endpoint: ${CLICKHOUSE_ENDPOINT}
    database: ${CLICKHOUSE_DATABASE}
    username: ${CLICKHOUSE_USER}
    password: ${CLICKHOUSE_PASSWORD}

    create_schema: false
    traces_table_name: otel_traces
    logs_table_name: otel_logs
    metrics_table_name: otel_metrics_gauge
    async_insert: true
    timeout: 10s
    retry_on_failure:
      enabled: true
      initial_interval: 5s
      max_interval: 30s
      max_elapsed_time: 300s

  debug:
    verbosity: basic

extensions:
  health_check:
    endpoint: 0.0.0.0:13133

service:
  extensions: [health_check]

  telemetry:
    logs:
      level: info
    metrics:
      level: detailed

  pipelines:
    traces:
      receivers: [kafka]
      processors: [batch]
      exporters: [clickhouse, debug]

    metrics:
      receivers: [kafka]
      processors: [batch]
      exporters: [clickhouse, debug]

    logs:
      receivers: [kafka]
      processors: [batch]
      exporters: [clickhouse, debug]
